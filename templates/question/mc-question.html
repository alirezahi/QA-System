{% extends 'main.html' %}
{% load static %}
{% load templatetags_custom %}
{% block 'main-content' %}
    <form action="/question/mc/check-answers/{{question.id}}" method="POST">
    {% csrf_token %}
        <div id="question-container" class="text-right p-3 bg-light rounded" >
            
        </div>
        <div id="answers-container" class="text-right p-3 bg-light rounded" >
            
        </div>
        {% if not answer_page %}
        <div class="text-center p-3">
            <button class="btn btn-success">
                ارسال پاسخ
            </button>
        </div>
        {% endif %}
    </form>
    {% if answer_page %}
    <div class="text-right mt-3">
        <div class="alert alert-info text-center">
            پاسخ‌ها
        </div>
        <ul class="list-group list-group-flush">
            {% for answer in answers %}
            <li class="list-group-item">سوال {{answer.order}}: {{answer.text}}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}




{% endblock %}
{% block 'js-block' %}
<script>
    var text = '{{ question.text }}';
    var question_choices = [
        {% for answer in question.answers.all %}
        {
            options:[
                {% for option in answer.options.all %}
                '{{option.text}}',
                {% endfor %}
            ]
        },
        {% endfor %}
    ];
    var reg = /&amp;&amp;__question__&amp;&amp;/g;
    var result;
    var counter = 0;

    var answer_status = function(user_answer, option){
        console.log({user_answer, option});
        return (user_answer === option ? 'checked' : '');
    };
    {% if answer_page %}
    var answers = [
        {% for answer in answers %}
        {
            order:{{answer.order}},
            text:'{{answer.text}}',
        },
        {% endfor %}
    ];
    var user_answers = [
        {% for answer in user_answers %}
        {
            order:{{answer.order}},
            text:'{{answer.text}}',
        },
        {% endfor %}
    ];
    {% endif %}
    var answer_text='';
    while((result = reg.exec(text)) !== null) {
        var input_text_questions = '<input name="'+(counter+1)+'" type="text" class="v-question-input" placeholder="'+(counter+1)+'" disabled/>';
        var input_text_answers = '<div>\
                    سوال '+(counter +1)+':\
                </div>\
                <div class="p-2">';
        for(var i=0;i<question_choices[counter]['options'].length;i++){
            input_text_answers += '<div class="custom-control custom-radio custom-control-inline">\
                            <input type="radio" id="customRadioInline'+(counter*4+i)+'" name="'+(counter+1)+'" class="custom-control-input" value="'+question_choices[counter]['options'][i]+'"{% if answer_page %} disabled{% endif %} {% if answer_page %} '+answer_status(user_answers[counter].text, question_choices[counter]['options'][i])+'{% endif %}>\
                            <label class="custom-control-label" for="customRadioInline'+(counter*4+i)+'">'+question_choices[counter]['options'][i]+'</label>\
                        </div>';
        }
        input_text_answers += '</div>';
        text = text.replace('/&amp;&amp;__question__&amp;&amp;/',input_text_questions);
        answer_text += input_text_answers;
        counter++;
    }

    
    $('#question-container').html(text);
    $('#answers-container').html(answer_text);
</script>
{% endblock %}